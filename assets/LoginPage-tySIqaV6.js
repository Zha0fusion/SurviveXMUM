import{_ as w,c as F,i as n,w as t,x as V,y as I,z as B,A as L,m as S,h as y,t as k,a as E,B as R,C as g,D,G as b,H as N,I as C,J as T,K as d,o as U}from"./index-DBK6WD2N.js";import{a as h}from"./index-xsH4HHeE.js";const q={name:"LoginPage",setup(){const s=g(null),l=T(),u=D({userEmail:"",code:""}),e={userEmail:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入有效的邮箱地址",trigger:["blur","change"]}],code:[{required:!0,message:"请输入验证码",trigger:"blur"},{min:4,max:6,message:"验证码长度通常为4-6位",trigger:"blur"}]},f=g(!1),i=g(!1),o=g(0),r=g(null),c=b(()=>o.value>0),p=b(()=>i.value?"发送中...":o.value>0?`${o.value}s 后重试`:"获取验证码"),v=async()=>{if(!s.value)return!1;try{return await s.value.validateField("userEmail"),!0}catch{return!1}},m=async()=>{if(!await v()){d.error("请输入有效的邮箱地址");return}if(!(c.value||i.value)){i.value=!0;try{const a=await h.post(`/api/login/send/code?email=${encodeURIComponent(u.userEmail)}`);a.data&&a.data.code===0?(C({title:"成功",message:"验证码已发送至您的邮箱，请注意查收。",type:"success"}),o.value=60,r.value=setInterval(()=>{o.value>0?o.value--:(clearInterval(r.value),r.value=null)},1e3)):d.error(a.data.message||"发送验证码失败，请稍后重试。")}catch(a){console.error("发送验证码错误:",a),d.error("发送验证码请求失败，请检查网络或联系管理员。")}finally{i.value=!1}}},x=async()=>{s.value&&s.value.validate(async _=>{if(_){f.value=!0;try{const a=await h.post("/api/login/email",{userEmail:u.userEmail,code:u.code});a.data&&a.data.code===0?(C({title:"登录成功",message:"欢迎回来！",type:"success"}),l.push("/")):d.error(a.data.message||"登录失败，邮箱或验证码错误。")}catch(a){console.error("登录错误:",a),d.error("登录请求失败，请检查网络或联系管理员。")}finally{f.value=!1}}else return d.error("请检查表单输入是否正确。"),!1})};return N(()=>{r.value&&clearInterval(r.value)}),{loginFormRef:s,loginForm:u,loginRules:e,isLoading:f,isSendingCode:i,sendCodeDisabled:c,sendCodeButtonText:p,handleSendCode:m,handleLogin:x}}},M={class:"login-page-container"};function P(s,l,u,e,f,i){const o=L,r=B,c=S,p=V,v=R;return U(),F("div",M,[n(v,{class:"login-card"},{header:t(()=>l[2]||(l[2]=[E("div",{class:"card-header"},[E("span",null,"用户登录")],-1)])),default:t(()=>[n(p,{ref:"loginFormRef",model:e.loginForm,rules:e.loginRules,"label-width":"80px",onSubmit:I(e.handleLogin,["prevent"])},{default:t(()=>[n(r,{label:"邮箱",prop:"userEmail"},{default:t(()=>[n(o,{modelValue:e.loginForm.userEmail,"onUpdate:modelValue":l[0]||(l[0]=m=>e.loginForm.userEmail=m),placeholder:"请输入邮箱地址",clearable:""},null,8,["modelValue"])]),_:1}),n(r,{label:"验证码",prop:"code"},{default:t(()=>[n(o,{modelValue:e.loginForm.code,"onUpdate:modelValue":l[1]||(l[1]=m=>e.loginForm.code=m),placeholder:"请输入验证码",clearable:"",style:{width:"calc(100% - 110px)","margin-right":"10px"}},null,8,["modelValue"]),n(c,{type:"primary",onClick:e.handleSendCode,disabled:e.isSendingCode||e.sendCodeDisabled,style:{width:"100px"}},{default:t(()=>[y(k(e.sendCodeButtonText),1)]),_:1},8,["onClick","disabled"])]),_:1}),n(r,null,{default:t(()=>[n(c,{type:"primary",onClick:e.handleLogin,loading:e.isLoading,class:"login-button"},{default:t(()=>l[3]||(l[3]=[y(" 登录 ")])),_:1,__:[3]},8,["onClick","loading"])]),_:1})]),_:1},8,["model","rules","onSubmit"])]),_:1})])}const G=w(q,[["render",P],["__scopeId","data-v-10d093be"]]);export{G as default};
